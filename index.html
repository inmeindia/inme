<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Inme Social - Feed</title>
    <style>
        body { font-family: sans-serif; background: #fafafa; margin: 0; padding-bottom: 50px; }
        .header { background: white; padding: 10px; text-align: center; border-bottom: 1px solid #dbdbdb; position: sticky; top: 0; z-index: 100; }
        .container { max-width: 500px; margin: 20px auto; padding: 10px; }
        
        /* Upload Card */
        .upload-card { background: white; border: 1px solid #dbdbdb; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        input, textarea, button { width: 100%; margin-top: 10px; border-radius: 5px; border: 1px solid #ddd; padding: 8px; box-sizing: border-box; }
        button { background: #0095f6; color: white; font-weight: bold; cursor: pointer; border: none; }

        /* Feed Post Styling */
        .post { background: white; border: 1px solid #dbdbdb; margin-bottom: 25px; border-radius: 8px; overflow: hidden; }
        .post img, .post video { width: 100%; display: block; max-height: 500px; object-fit: cover; }
        .post-content { padding: 15px; }
        .caption { margin: 0; font-size: 14px; }
        .time { font-size: 10px; color: gray; margin-top: 5px; }
    </style>
</head>
<body>

<div class="header"><h2>Inme</h2></div>

<div class="container">
    <div class="upload-card">
        <input type="file" id="mediaInput" accept="image/*,video/*" multiple>
        <textarea id="caption" placeholder="Aapke mann mein kya hai?"></textarea>
        <button id="uploadBtn">Post Karein</button>
        <p id="status" style="font-size: 12px; text-align: center;"></p>
    </div>

    <div id="postFeed"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD2uK-htnjXv_UmgQMexDTj5odcGdpqEFg",
    authDomain: "inme-f7076.firebaseapp.com",
    projectId: "inme-f7076",
    storageBucket: "inme-f7076.firebasestorage.app",
    messagingSenderId: "940199729594",
    appId: "1:940199729594:web:fe17ed05a2ff3c5d542583"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // --- 1. UPLOAD LOGIC ---
  const uploadBtn = document.getElementById('uploadBtn');
  uploadBtn.onclick = async () => {
    const files = document.getElementById('mediaInput').files;
    const caption = document.getElementById('caption').value;
    if(files.length === 0) return alert("File chuno!");
    
    // Yahan wahi 30MB/90s wala logic lagana hai jo pehle bataya tha
    uploadBtn.disabled = true;
    document.getElementById('status').innerText = "Uploading...";

    const urls = [];
    for (let f of files) {
        const sRef = ref(storage, 'posts/' + Date.now() + "_" + f.name);
        await uploadBytes(sRef, f);
        urls.push(await getDownloadURL(sRef));
    }

    await addDoc(collection(db, "posts"), {
        mediaUrls: urls,
        caption: caption,
        createdAt: serverTimestamp(),
        type: files[0].type.startsWith('video') ? 'video' : 'image'
    });
    location.reload(); 
  };

  // --- 2. FEED FETCH LOGIC (Displaying Posts) ---
  const feedDiv = document.getElementById('postFeed');
  const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
  const querySnapshot = await getDocs(q);

  querySnapshot.forEach((doc) => {
    const data = doc.data();
    const postEl = document.createElement('div');
    postEl.className = 'post';

    let mediaHTML = '';
    data.mediaUrls.forEach(url => {
        if(data.type === 'video') {
            mediaHTML += `<video src="${url}" controls></video>`;
        } else {
            mediaHTML += `<img src="${url}">`;
        }
    });

    postEl.innerHTML = `
        ${mediaHTML}
        <div class="post-content">
            <p class="caption"><b>User</b> ${data.caption}</p>
            <p class="time">${data.createdAt ? data.createdAt.toDate().toLocaleString() : 'Just now'}</p>
        </div>
    `;
    feedDiv.appendChild(postEl);
  });
</script>
</body>
</html>
